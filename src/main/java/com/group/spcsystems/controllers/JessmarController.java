/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.group.spcsystems.controllers;

import Tool.JDBCUtils;
import com.group.spcsystems.entity.Articulos;
import com.group.spcsystems.entity.Cattipopedido;
import com.group.spcsystems.entity.Clientes;
import com.group.spcsystems.entity.Pedidos;
import com.group.spcsystems.entity.Usuarios;
import com.group.spcsystems.entity.Vendedores;
import java.sql.Connection;
import java.sql.SQLException;
import java.sql.SQLRecoverableException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.ResultSetHandler;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import org.apache.commons.dbutils.handlers.MapHandler;
import org.apache.commons.dbutils.handlers.MapListHandler;

/**
 *
 * @author jadut
 */
public class JessmarController {
    
String  GET_LISTA_DE_PEDIDOS = "select * from pedidos order by id  desc";
    
public List<Pedidos> getListaPedidos(){
 System.out.println("getListaPedidos");
 Connection dbCon = null;
 List<Pedidos> listapedidos = new ArrayList<Pedidos>();
 
 try{
     
		dbCon = new JDBCUtils().connectDatabase();
                QueryRunner run = new QueryRunner();

                // Use the BeanListHandler implementation to convert all
                // ResultSet rows into a List of Person JavaBeans.
                ResultSetHandler<List<Pedidos>> h = new BeanListHandler<Pedidos>(Pedidos.class);

                // Execute the SQL statement and return the results in a List of
                // Person objects generated by the BeanListHandler.
                listapedidos = run.query(dbCon, GET_LISTA_DE_PEDIDOS, h );

 }catch(Exception e){
                e.printStackTrace();
 }finally{

            if(dbCon!=null){
                 try{
                     dbCon.close();
                 }catch(SQLException sqle){
                 }
             }
            
 }
return listapedidos;
}
    
String  GET_LISTA_DE_USUARIOS = "select * from usuarios order by id desc";
    
public List<Usuarios> getListaUsuarios(){
 System.out.println("getListaUsuarios");
 Connection dbCon = null;
 List<Usuarios> listausuarios = new ArrayList<Usuarios>();
 
 try{
     
		dbCon = new JDBCUtils().connectDatabase();
                QueryRunner run = new QueryRunner();

                // Use the BeanListHandler implementation to convert all
                // ResultSet rows into a List of Person JavaBeans.
                ResultSetHandler<List<Usuarios>> h = new BeanListHandler<Usuarios>(Usuarios.class);

                // Execute the SQL statement and return the results in a List of
                // Person objects generated by the BeanListHandler.
                listausuarios = run.query(dbCon, GET_LISTA_DE_USUARIOS, h );

 }catch(Exception e){
                e.printStackTrace();
 }finally{

            if(dbCon!=null){
                 try{
                     dbCon.close();
                 }catch(SQLException sqle){
                 }
             }
            
 }
return listausuarios;
}
    

public Usuarios getOneUsuario(String idusuario) {

     //TODO write your implementation code here:
     Usuarios   reng = null;
     Connection dbCon = null;
     try{

            dbCon =   new JDBCUtils().connectDatabase();

            QueryRunner run = new QueryRunner();

            // Use the BeanListHandler implementation to convert all
            // ResultSet rows into a List of Person JavaBeans.
            ResultSetHandler<Usuarios> h =
                    new BeanHandler<Usuarios>(Usuarios.class);

            // Execute the SQL statement and return the results in a List of
            // Person objects generated by the BeanListHandler.
            String query = "select * from usuarios where usuario=? ";

            reng = run.query(dbCon, query , h , idusuario);

     }catch ( SQLRecoverableException rec){

                rec.printStackTrace();

        }catch(Exception ex){
            
                ex.printStackTrace();
                
        }finally{
         
                if(dbCon!=null){
                     try{
                         dbCon.close();
                     }catch(SQLException sqle){
                             sqle.printStackTrace();
                     }
                 }

        }

    return reng;

}

String  GET_CATALOGO_TIPO_PEDIDO = "select * from cattipopedido order by id desc";

public List<Cattipopedido> getCatalogoTipoPedido(){
     //TODO write your implementation code here:
     List<Cattipopedido> cattipospedido = new ArrayList<Cattipopedido>();
     Connection dbCon = null;
     try{

            dbCon =   new JDBCUtils().connectDatabase();

            QueryRunner run = new QueryRunner();

            // Use the BeanListHandler implementation to convert all
            // ResultSet rows into a List of Person JavaBeans.
            ResultSetHandler<List<Cattipopedido>> h = new BeanListHandler<Cattipopedido>(Cattipopedido.class);
            

            // Execute the SQL statement and return the results in a List of
            // Person objects generated by the BeanListHandler.
         

            cattipospedido = run.query(dbCon, GET_CATALOGO_TIPO_PEDIDO , h );

     }catch ( SQLRecoverableException rec){

                rec.printStackTrace();

        }catch(Exception ex){
            
                ex.printStackTrace();
                
        }finally{
         
                if(dbCon!=null){
                     try{
                         dbCon.close();
                     }catch(SQLException sqle){
                             sqle.printStackTrace();
                     }
                 }

        }

    return cattipospedido;
}
    

String  GET_CATALOGO_VENDEDORES = "select * from vendedores where activo = true order by id asc";

public List<Vendedores> getCatalogoVendedores(){
     
     List<Vendedores> vendedores = new ArrayList<Vendedores>();
     Connection dbCon = null;
     try{

            dbCon =   new JDBCUtils().connectDatabase();

            QueryRunner run = new QueryRunner();

            // Use the BeanListHandler implementation to convert all
            // ResultSet rows into a List of Person JavaBeans.
            ResultSetHandler<List<Vendedores>> h = new BeanListHandler<Vendedores>(Vendedores.class);
            

            // Execute the SQL statement and return the results in a List of
            // Person objects generated by the BeanListHandler.
         

            vendedores = run.query(dbCon, GET_CATALOGO_VENDEDORES , h );

     }catch ( SQLRecoverableException rec){

                rec.printStackTrace();

        }catch(Exception ex){
            
                ex.printStackTrace();
                
        }finally{
         
                if(dbCon!=null){
                     try{
                         dbCon.close();
                     }catch(SQLException sqle){
                             sqle.printStackTrace();
                     }
                 }

        }

    return vendedores;
}


String  GET_CATALOGO_ARTICULOS = "select * from articulos where activo = true order by id asc";

public List<Articulos> getCatalogoArticulos(){
     
     List<Articulos> articulos = new ArrayList<Articulos>();
     Connection dbCon = null;
     try{

            dbCon =   new JDBCUtils().connectDatabase();

            QueryRunner run = new QueryRunner();

            // Use the BeanListHandler implementation to convert all
            // ResultSet rows into a List of Person JavaBeans.
            ResultSetHandler<List<Articulos>> h = new BeanListHandler<Articulos>(Articulos.class);
            

            // Execute the SQL statement and return the results in a List of
            // Person objects generated by the BeanListHandler.
         

            articulos = run.query(dbCon, GET_CATALOGO_ARTICULOS , h );

     }catch ( SQLRecoverableException rec){

                rec.printStackTrace();

        }catch(Exception ex){
            
                ex.printStackTrace();
                
        }finally{
         
                if(dbCon!=null){
                     try{
                         dbCon.close();
                     }catch(SQLException sqle){
                             sqle.printStackTrace();
                     }
                 }

        }

    return articulos;
}
    


String  GET_CATALOGO_CLIENTES = "select * from clientes  order by id asc";

public List<Clientes> getCatalogoClientes(){
     
     List<Clientes> clientes = new ArrayList<Clientes>();
     Connection dbCon = null;
     try{

            dbCon =   new JDBCUtils().connectDatabase();

            QueryRunner run = new QueryRunner();

            // Use the BeanListHandler implementation to convert all
            // ResultSet rows into a List of Person JavaBeans.
            ResultSetHandler<List<Clientes>> h = new BeanListHandler<Clientes>(Clientes.class);
            

            // Execute the SQL statement and return the results in a List of
            // Person objects generated by the BeanListHandler.
         

            clientes = run.query(dbCon, GET_CATALOGO_CLIENTES , h );

     }catch ( SQLRecoverableException rec){

                rec.printStackTrace();

        }catch(Exception ex){
            
                ex.printStackTrace();
                
        }finally{
         
                if(dbCon!=null){
                     try{
                         dbCon.close();
                     }catch(SQLException sqle){
                             sqle.printStackTrace();
                     }
                 }

        }

    return clientes;
}

 String  GET_LISTA_DE_ARTICULOS = "select * from articulos where activo = true order by id asc";

public Map<String, Object> getListaArticulos(){
 System.out.println("getListaArticulos");
 Connection dbCon = null;
 Map<String, Object> resp = new HashMap<String, Object> ();
 List<Map<String, Object>> listaarticulos = new ArrayList<Map<String, Object>>();
 
 try{
     
		dbCon = new JDBCUtils().connectDatabase();
                 QueryRunner queryRunner = new QueryRunner();
             
                listaarticulos = queryRunner.query(dbCon, GET_LISTA_DE_ARTICULOS, new MapListHandler() );
                
                if(listaarticulos == null || listaarticulos.isEmpty()){
                        resp.put("success", Boolean.FALSE);
                        resp.put("erromsg", "The Table is empty");
                        resp.put("payload", null);                    
                }else{
                        resp.put("success", Boolean.TRUE);
                        resp.put("erromsg", null);
                        resp.put("payload", listaarticulos);
                }

 }catch(Exception e){
                e.printStackTrace();
 }finally{

            if(dbCon!=null){
                 try{
                     dbCon.close();
                 }catch(SQLException sqle){
                 }
             }
            
 }
 return resp;

}

String  GET_PEDIDOBYID = "select * from pedidos where id =";
String  GET_PEDIDOSDETALLE = "select * from pedidos_detalle where pedido_id =";

public Map<String, Object> getPedidoById(String id){
 System.out.println("getPedidoById con id " + id );
 Connection dbCon = null;
 
 Map<String, Object> pedido = new HashMap<String, Object>();
 List<Map<String, Object>> pedidosdetalle = new ArrayList<Map<String, Object>>();
 Map<String, Object> resp = new HashMap<String, Object> ();
  
 if(!StringUtils.isNumeric(id)){
     resp.put("success", Boolean.FALSE);
     resp.put("erromsg", "ID invalido");
     resp.put("payload", null);
     
     return resp;
 }
 
 try{
     
		dbCon = new JDBCUtils().connectDatabase();           
                QueryRunner queryRunner = new QueryRunner();
                
                pedido = queryRunner.query(dbCon, GET_PEDIDOBYID+id, new MapHandler() );
                
                if(pedido != null &&  !pedido.isEmpty() ){ //  Proceso detalles
                    
                    
                    pedidosdetalle = queryRunner.query(dbCon, GET_PEDIDOSDETALLE+id, new MapListHandler() );
                    
                    
                    pedido.put("pedidosdetalle",pedidosdetalle);
                    
                    resp.put("success", Boolean.TRUE);
                    resp.put("erromsg", null);
                    resp.put("payload", pedido);
                    
                }else{
                    resp.put("success", Boolean.FALSE);
                    resp.put("erromsg", "ID not found");
                    resp.put("payload", null);
                }

 }catch(Exception e){
                e.printStackTrace();
 }finally{

            if(dbCon!=null){
                 try{
                     dbCon.close();
                 }catch(SQLException sqle){
                 }
             }
            
 }
return resp;
}
}
